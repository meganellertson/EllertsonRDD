---
title: "RDD Replication 1"
author: "Megan Ellertson"
date: "2/14/2021"
output:
  pdf_document: default
  html_document: default
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, message=FALSE}
library(readr)
library(tidyverse)
library(ggplot2)
library(readr)
library(dplyr)
library(tidyr)
library(rdd)
library(haven)
library(estimatr)
library(rdrobust)
library(rddensity)
library(cli)
library(kableExtra)
library(stargazer)

library(Statamarkdown)
stataexe <-"C:/Program Files/Stata16/StataIC-64.exe"
knitr::opts_chunk$set(engine.path=list(stata=stataexe))


```

Question 1

```{r, echo=FALSE, message=FALSE }

raw_hansen_dwi <- read_csv("Data/hansen_dwi.csv")

```

Question 2 
**Summary**

Question 3

```{r, echo= FALSE, message=FALSE }
RDDdata <- raw_hansen_dwi %>%
  mutate(dui = car::Recode(bac1, "lo: 0.08=0; else = 1")) %>%
  mutate(lininteract = dui*bac1) %>%
  mutate(bac1sq = bac1 ^ 2) %>%
  mutate(quadinteract = dui*bac1sq)

``` 
````{stata}
use hansen_dwi.dta
summarize
```

```{r}
sumstat = data.frame(
  Measure = c("Recidivism", "BAC", "DUI", "Male", "Accident", "Age", "White"),
  Means  = c(mean(RDDdata$recidivism), mean(RDDdata$bac1), mean(RDDdata$dui), 
           mean(RDDdata$male), mean(RDDdata$acc), mean(RDDdata$aged), 
           mean(RDDdata$white)),
  StandardErrors= c(sd(RDDdata$recidivism), sd(RDDdata$bac1),
                    sd(RDDdata$dui), sd(RDDdata$male),
                    sd(RDDdata$acc),sd(RDDdata$aged), 
                    sd(RDDdata$white)),
    Minimum  = c(min(RDDdata$recidivism), min(RDDdata$bac1), 
                 min(RDDdata$dui), min(RDDdata$male),
                 min(RDDdata$acc),min(RDDdata$aged), 
                 min(RDDdata$white)),
      Maximum  = c(max(RDDdata$recidivism), max(RDDdata$bac1), 
                   max(RDDdata$dui), max(RDDdata$male), 
                   max(RDDdata$acc), max(RDDdata$aged), 
                   max(RDDdata$white))
            
)
  sumstat

```

```{r}

```

````{stata}
use hansen_dwi
tabulate bac1
````

Question 4 
```{r}
stargazer(RDDdata, type = "text", sytle="aer", summary = TRUE)
```


```{r]


```



```{r}
figure1 <- ggplot(RDDdata, aes(bac1)) +
  geom_histogram(binwidth = 0.001, color = "grey", fill = "white") 
figure1 + geom_vline(aes(xintercept = 0.08), color = "black", size = 1) +
  geom_vline(aes(xintercept = 0.15), color = "black", size = 1) +
  labs(title = "BAC Histogram", x = "bac1", y = "Frequency")
```

```{r}

DCdensity(RDDdata$bac1, cutpoint = 0.08)

density <- rddensity(RDDdata$bac1, c = 0.08)
rdplotdensity(density, RDDdata$bac1)
```


Equation 1
$equation$

Question 5 
```{r} 

```


Question 6
```{r }


```

![testing](Figures/Linear.png)


Question 7
```{r}





```



Question 8
```{r}
categories <- RDDdata$bac1 
demmeans <- split(RDDdata$recidivism, cut(RDDdata$bac1, 100)) %>%
  lapply(mean) %>%
  unlist()
agg_RDDdata <- data.frame(recidivism = demmeans, bac1 = seq(0.01, 0.5, by = 0.01))
plottingdata <- RDDdata %>%
  mutate(gg_group = case_when(bac1>= 0.08 ~ 1, TRUE ~ 0))

ggplot(plottingdata, aes(bac1, recidivism)) +
  geom_point(aes(x=bac1, y = recidivism), data = agg_RDDdata) + xlim(0, 0.2) + ylim(0.08, 0.16) +
  stat_smooth(aes(bac1, recidivism, group = gg_group), method = "lm", formula = y ~ x + I(x^2)) +
  xlim(0,0.2) + ylim(0,1) +
  geom_vline(xintercept = 0.08)

ggplot(plottingdata, aes(bac1, recidivism)) +
  geom_point(aes(x=bac1, y = recidivism), data = agg_RDDdata) +
  stat_smooth(aes(bac1, recidivism, group = gg_group), method = "lm") +
  geom_vline(xintercept = 0.08)
  
```


Question 9

```{r}

```


